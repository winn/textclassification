<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Input Fields</title>
    <style>
        .input-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 300px;
        }
        #result {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="input-container">
        <h2>Enter Your Information</h2>
        <form id="inputForm">
            <label for="prompt">Prompt:</label>
            <input type="text" id="prompt" name="prompt" readonly><br>
            <button type="button" id="startRecognition">Start Recognition</button>
            
            <input type="hidden" id="history" name="history"><br>
            
            <label for="apiKey">API Key:</label>
            <input type="password" id="apiKey" name="apiKey"><br>
            
            <label for="model">Model:</label>
            <input type="text" id="model" name="model"><br>

            <label for="maxToken">Max Token:</label>
            <input type="text" id="maxToken" name="maxToken"><br>

            <button type="submit">Submit</button>
        </form>
    </div>
    <div id="result"></div>
    <div id="audiourl"></div>
    <audio id="audio-player" controls></audio>

<script>
      var hist = '';

      document.getElementById("history").value = hist;
      
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'en-US';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      document.getElementById('startRecognition').addEventListener('click', () => {
        recognition.start();
      });

      recognition.addEventListener('result', (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById('prompt').value = transcript;
      });

      async function textToSpeech(text) {
        const data = {
          "text": text,
          "speaker": "1",
          "volume": 1,
          "speed": 1,
          "type_media": "wav",
          "save_file":false
        };

        const response = await fetch("https://api-voice.botnoi.ai/api/service/generate_audio", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Botnoi-Token": "07895990c0e0afa81baf39d85dc685c8d1acc5cfce4502f3f8e6c7d4d0fc5ad8"
          },
          body: JSON.stringify(data)
        });

        const result = await response.blob();
        console.log(result)

        const audioPlayer = document.getElementById('audio-player');
        const audioURL = URL.createObjectURL(result);
        audioPlayer.src = audioURL;
        audioPlayer.play();
        // const audioURL = result.url;
        // document.getElementById("audiourl").value = audioURL;


        // Create an audio element and play the audio
        // const audio = new Audio(audioURL);
        // audio.play();
      }

      document.getElementById("inputForm").addEventListener("submit", async function(event) {
        event.preventDefault();

        const prompt = document.getElementById("prompt").value;
        const apiKey = document.getElementById("apiKey").value;
        const model = document.getElementById("model").value;
        const maxToken = document.getElementById("maxToken").value;
        const history = document.getElementById("history").value;

        const data = {
          prompt: prompt,
          history: history,
          apiKey: apiKey,
          model: model,
          maxToken: maxToken
        };

        console.log("Sending data to the API:", data);

        try {
          const response = await fetch("https://botnoichatgpt.herokuapp.com/generate_text", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
          });

          if (!response.ok) {
            const responseText = await response.text();
            console.error("API error:", response.status, response.statusText, responseText);
            return;
          }

          const result = await response.json();
          displayResult(result);
          document.getElementById("history").value = result.history;
          console.log('calling')
          textToSpeech(result.answer.content); // Call the text-to-speech function with the response text
        } catch (error) {
          console.error("Fetch error:", error);
        }
      });

      function displayResult(result) {
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = `<pre>${JSON.stringify(result.answer.content, null, 2)}</pre>`;
        document.getElementById("history").value = result.history;
      }
    </script>
</body>
</html>

